<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ManikShan Foreign Employment PVT LTD</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font and basic body setup */
        body { font-family: "Inter", sans-serif; background-color: #f0f4f8; }
        /* Custom style for the reason input */
        .reason-input-field {
            border: 1px solid #d1d5db; /* Gray-300 */
            background-color: #f9fafb; /* Gray-50 */
        }
        /* Style for the reason input when 'Yes' is selected for agency */
        input[name="agency"][value="Yes"]:checked ~ #agencyReasonContainer .reason-input-field {
            border: 1px solid #10b981 !important; /* Green-500 */
            background-color: #ecfdf5; /* Green-50 */
        }
        /* General style for the reason input when conditional (e.g., location=No) */
        input[name="location"][value="No"]:checked ~ #locationReasonContainer .reason-input-field {
            border: 1px solid #dc2626 !important; /* Red-600 */
            background-color: #fef2f2; /* Red-50 */
        }
        /* Ensure the form scales down gracefully on mobile */
        .form-group {
            margin-bottom: 1.5rem; /* Better vertical spacing */
        }
    </style>
</head>
<body class="p-4 sm:p-8">

<form id="questionnaireForm" onsubmit="event.preventDefault(); generatePDF();" class="container bg-white p-6 sm:p-10 rounded-xl shadow-2xl mx-auto w-full max-w-4xl border border-blue-100">
    <h1 class="text-2xl sm:text-3xl font-extrabold text-blue-800 text-center mb-4">ManikShan Foreign Employment PVT LTD</h1>
    <p class="text-center text-gray-500 mb-8 text-sm sm:text-base">Please fill in all details.</p>

    <script>
        const toggleReason = (name, show) => {
            const container = document.getElementById(`${name}ReasonContainer`);
            if (container) {
                container.classList.toggle('hidden', !show);
                // The reason input itself
                const reasonInput = document.getElementById(`${name}Reason`);
                // Reason fields are no longer required
                if (reasonInput && !show) {
                    reasonInput.value = ''; 
                }
            }
        };
        
        const toggleOtherReferral = (value) => {
            const container = document.getElementById('otherReferralContainer');
            const input = document.getElementById('otherReferralSource');
            const isOther = value === 'Other';
            container.classList.toggle('hidden', !isOther);
            // Input is no longer required
            if (!isOther) {
                input.value = '';
            }
        };

        // CORRECTED: Toggle visibility of the 'willing to get vaccinated' question
        const toggleWillingToVaccinate = (value) => {
            const container = document.getElementById('willingToVaxContainer');
            const inputs = container.querySelectorAll('input[name="willingToVax"]');
            // Show only if the answer to "Are you vaccinated?" is 'No'
            const show = value === 'No'; 
            container.classList.toggle('hidden', !show);
            
            inputs.forEach(input => {
                // Radio buttons are no longer required
                if (!show) {
                    input.checked = false;
                }
            });

            // The 'vaccineType' input is no longer required
            const vaccineTypeInput = document.getElementById('vaccineType');
            if (value !== 'Yes') {
                vaccineTypeInput.value = '';
            }
        };

        // Initialize visibility on load
        document.addEventListener('DOMContentLoaded', () => {
            // Agency question logic (shows reason on 'Yes')
            const agencyYes = document.getElementById('agencyYes');
            toggleReason('agency', agencyYes && agencyYes.checked);
            
            // Location question logic (shows reason on 'No')
            const locationNo = document.getElementById('locNo');
            toggleReason('location', locationNo && locationNo.checked);

            // Other 'Yes' fields
            const fieldsYes = ['customPlacement', 'workedUSA', 'familyUSA', 'medical', 'doctorCare', 'crime', 'visa'];
            fieldsYes.forEach(name => {
                const yesRadio = document.getElementById(`${name.startsWith('customPlacement') ? 'cp' : name.startsWith('workedUSA') ? 'usaWork' : name.startsWith('familyUSA') ? 'family' : name.startsWith('doctorCare') ? 'doc' : name}Yes`);
                toggleReason(name, yesRadio && yesRadio.checked);
            });
            
            // Initialize for vaccination conditional field
            const vaxYes = document.getElementById('vaxYes');
            const vaxNo = document.getElementById('vaxNo');
            if (vaxYes && vaxYes.checked) {
                toggleWillingToVaccinate('Yes');
            } else if (vaxNo && vaxNo.checked) {
                toggleWillingToVaccinate('No');
            } else {
                toggleWillingToVaccinate('');
            }

            toggleOtherReferral(document.getElementById('referralSource').value);
            
            // Add listener for the 'asap' checkbox
            document.getElementById('asap').addEventListener('change', function() {
                const programStartInput = document.getElementById('programStart');
                if (this.checked) {
                    programStartInput.value = 'As soon as possible';
                    programStartInput.disabled = true;
                } else {
                    programStartInput.value = '';
                    programStartInput.disabled = false;
                    programStartInput.focus();
                }
            });
        });
    </script>

    <div class="space-y-5">
        <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">1. Personal Details</h2>
        <div class="grid md:grid-cols-2 gap-6">
            <div class="form-group">
                <label for="name" class="block font-medium text-gray-600 mb-1">Name:</label>
                <input type="text" id="name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
            </div>
            <div class="form-group">
                <label for="email" class="block font-medium text-gray-600 mb-1">Email:</label>
                <input type="email" id="email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
            </div>
        </div>
        <div class="form-group">
            <label for="skype" class="block font-medium text-gray-600 mb-1">Skype ID:</label>
            <input type="text" id="skype" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
        </div>
    </div>
    
    <div class="my-8 border-t border-gray-200"></div>

    <div class="space-y-5">
        <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">2. Program & Referral Information</h2>
        <div class="grid md:grid-cols-2 gap-6">
            <div class="form-group">
                <label for="referralSource" class="block font-medium text-gray-600 mb-1">How did you hear about ManikShan Foreign Employment?</label>
                <select id="referralSource" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150" onchange="toggleOtherReferral(this.value)">
                    <option value="" disabled selected>Select an option</option>
                    <option value="Referral">Referral</option>
                    <option value="School">School</option>
                    <option value="LinkedIn">LinkedIn</option>
                    <option value="IRES Website">IRES Website</option>
                    <option value="Facebook/Instagram">Facebook/Instagram</option>
                    <option value="HOSCO">HOSCO</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="referredBy" class="block font-medium text-gray-600 mb-1"> Were you referred by someone? If yes, who?</label>
                <input type="text" id="referredBy" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
            </div>
        </div>
         <div class="form-group hidden" id="otherReferralContainer">
            <label for="otherReferralSource" class="block font-medium text-gray-600 mb-1">Please specify:</label>
            <input type="text" id="otherReferralSource" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
        </div>
        <div class="form-group">
            <label class="block font-medium text-gray-600 mb-2">Working with any other Agency?</label>
            <div class="radio-group flex flex-wrap gap-x-8 gap-y-4">
                <div class="flex items-center"><input type="radio" name="agency" value="Yes" id="agencyYes" class="h-4 w-4 text-blue-600" onchange="toggleReason('agency', true)"><label for="agencyYes" class="ml-2 text-gray-700">Yes</label></div>
                <div class="flex items-center"><input type="radio" name="agency" value="No" id="agencyNo" class="h-4 w-4 text-blue-600" onchange="toggleReason('agency', false)"><label for="agencyNo" class="ml-2 text-gray-700">No</label></div>
            </div>
            <div id="agencyReasonContainer" class="mt-3 hidden transition duration-300">
                <label for="agencyReason" class="block text-sm text-gray-600 mb-1">If yes, what Agency and what fees are you required to pay?:</label>
                <input type="text" id="agencyReason" class="w-full p-2 rounded-lg reason-input-field" value="">
            </div>
        </div>
    </div>

    <div class="my-8 border-t border-gray-200"></div>

    <div class="space-y-5">
        <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">3. Placement Preferences</h2>
        <div class="form-group">
            <label class="block font-medium text-gray-600 mb-2">What department(s) are you applying for?</label>
            <div class="flex flex-col sm:flex-row sm:items-end sm:space-x-6 space-y-4 sm:space-y-0">
                <div class="flex-1">
                    <label for="firstChoice" class="block text-sm font-medium text-gray-500">First Choice:</label>
                    <input type="text" id="firstChoice" class="w-full p-2 bg-transparent border-b-2 border-gray-300 focus:outline-none focus:border-blue-500 transition">
                </div>
                <div class="flex-1">
                    <label for="secondChoice" class="block text-sm font-medium text-gray-500">Second Choice:</label>
                    <input type="text" id="secondChoice" class="w-full p-2 bg-transparent border-b-2 border-gray-300 focus:outline-none focus:border-blue-500 transition">
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="block font-medium text-gray-600 mb-3">When do you want to begin your program and for how long?</label>
            <div class="flex flex-col sm:flex-row sm:items-center space-y-3 sm:space-y-0 sm:space-x-4 mb-4">
                <input type="text" id="programStart" placeholder="Start Date e.g., 'Next Fall' or 'June 2025'" class="flex-grow p-2 bg-transparent border-b-2 border-gray-300 focus:outline-none focus:border-blue-500 transition">
                <div class="flex items-center">
                    <input type="checkbox" id="asap" name="asap" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="asap" class="ml-2 text-gray-700 whitespace-nowrap">As soon as possible</label>
                </div>
            </div>
            <div class="radio-group flex flex-wrap items-center gap-x-6 gap-y-3">
                <span class="font-medium text-gray-600 mr-2">Length:</span>
                <div class="flex items-center"><input type="radio" name="length" value="6 months" id="len6" class="h-4 w-4 text-blue-600"><label for="len6" class="ml-2 text-gray-700">6 months</label></div>
                <div class="flex items-center"><input type="radio" name="length" value="9 months" id="len9" class="h-4 w-4 text-blue-600"><label for="len9" class="ml-2 text-gray-700">9 months</label></div>
                <div class="flex items-center"><input type="radio" name="length" value="12 months" id="len12" class="h-4 w-4 text-blue-600"><label for="len12" class="ml-2 text-gray-700">12 months</label></div>
                <div class="flex items-center"><input type="radio" name="length" value="18 months" id="len18" class="h-4 w-4 text-blue-600"><label for="len18" class="ml-2 text-gray-700">18 months</label></div>
            </div>
        </div>
    </div>

    <div class="my-8 border-t border-gray-200"></div>

    <div class="space-y-5">
        <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">4. USA and Placement Status</h2>
        
        <div class="grid sm:grid-cols-2 gap-6">
            <div class="form-group">
                <label class="block font-medium text-gray-600 mb-2">Are you 100% open to ALL locations?</label>
                <div class="radio-group flex flex-wrap gap-x-8 gap-y-4">
                    <div class="flex items-center"><input type="radio" name="location" value="Yes" id="locYes" class="h-4 w-4 text-blue-600" onchange="toggleReason('location', false)"><label for="locYes" class="ml-2 text-gray-700">Yes</label></div>
                    <div class="flex items-center"><input type="radio" name="location" value="No" id="locNo" class="h-4 w-4 text-blue-600" onchange="toggleReason('location', true)"><label for="locNo" class="ml-2 text-gray-700">No</label></div>
                </div>
                <div id="locationReasonContainer" class="mt-3 hidden transition duration-300">
                    <label for="locationReason" class="block text-sm text-gray-600 mb-1"> If not, where would you like to be placed?</label>
                    <input type="text" id="locationReason" class="w-full p-2 rounded-lg reason-input-field" value="">
                </div>
            </div>

            <div class="form-group">
                <label class="block font-medium text-gray-600 mb-2">Do you want a Custom Placement with another candidate?</label>
                <div class="radio-group flex flex-wrap gap-x-8 gap-y-4">
                    <div class="flex items-center"><input type="radio" name="customPlacement" value="Yes" id="cpYes" class="h-4 w-4 text-blue-600" onchange="toggleReason('customPlacement', true)"><label for="cpYes" class="ml-2 text-gray-700">Yes</label></div>
                    <div class="flex items-center"><input type="radio" name="customPlacement" value="No" id="cpNo" class="h-4 w-4 text-blue-600" onchange="toggleReason('customPlacement', false)"><label for="cpNo" class="ml-2 text-gray-700">No</label></div>
                </div>
                <div id="customPlacementReasonContainer" class="mt-3 hidden transition duration-300">
                    <label for="customPlacementReason" class="block text-sm text-gray-600 mb-1">If yes, what is the full name of the other candidate?</label>
                    <input type="text" id="customPlacementReason" class="w-full p-2 rounded-lg reason-input-field" value="">
                </div>
            </div>

            <div class="form-group">
                <label class="block font-medium text-gray-600 mb-2">Have you ever trained/worked in the USA?</label>
                <div class="radio-group flex flex-wrap gap-x-8 gap-y-4">
                    <div class="flex items-center"><input type="radio" name="workedUSA" value="Yes" id="usaWorkYes" class="h-4 w-4 text-blue-600" onchange="toggleReason('workedUSA', true)"><label for="usaWorkYes" class="ml-2 text-gray-700">Yes</label></div>
                    <div class="flex items-center"><input type="radio" name="workedUSA" value="No" id="usaWorkNo" class="h-4 w-4 text-blue-600" onchange="toggleReason('workedUSA', false)"><label for="usaWorkNo" class="ml-2 text-gray-700">No</label></div>
                </div>
                 <div id="workedUSAReasonContainer" class="mt-3 hidden transition duration-300">
                    <label for="workedUSAReason" class="block text-sm text-gray-600 mb-1">If yes, when & what type of Visa did you receive?</label>
                    <input type="text" id="workedUSAReason" class="w-full p-2 rounded-lg reason-input-field" value="">
                </div>
            </div>

            <div class="form-group">
                <label class="block font-medium text-gray-600 mb-2">Do you have any family that resides in the USA?</label>
                <div class="radio-group flex flex-wrap gap-x-8 gap-y-4">
                    <div class="flex items-center"><input type="radio" name="familyUSA" value="Yes" id="familyYes" class="h-4 w-4 text-blue-600" onchange="toggleReason('familyUSA', true)"><label for="familyYes" class="ml-2 text-gray-700">Yes</label></div>
                    <div class="flex items-center"><input type="radio" name="familyUSA" value="No" id="familyNo" class="h-4 w-4 text-blue-600" onchange="toggleReason('familyUSA', false)"><label for="familyNo" class="ml-2 text-gray-700">No</label></div>
                </div>
                <div id="familyUSAReasonContainer" class="mt-3 hidden transition duration-300">
                    <label for="familyUSAReason" class="block text-sm text-gray-600 mb-1">If yes, please list their name, relationship, and location:</label>
                    <input type="text" id="familyUSAReason" class="w-full p-2 rounded-lg reason-input-field" value="">
                </div>
            </div>
        </div>
    </div>

    <div class="my-8 border-t border-gray-200"></div>

    <div class="space-y-5">
        <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">5. Health & Legal Status</h2>
        
        <div class="grid md:grid-cols-2 gap-6">
            <div class="form-group col-span-2">
                <label class="block font-medium text-gray-600 mb-2">Are you vaccinated?</label>
                <div class="radio-group flex flex-wrap gap-x-8 gap-y-4">
                    <div class="flex items-center"><input type="radio" name="vaccinated" value="Yes" id="vaxYes" class="h-4 w-4 text-blue-600" onchange="toggleWillingToVaccinate('Yes')"><label for="vaxYes" class="ml-2 text-gray-700">Yes</label></div>
                    <div class="flex items-center"><input type="radio" name="vaccinated" value="No" id="vaxNo" class="h-4 w-4 text-blue-600" onchange="toggleWillingToVaccinate('No')"><label for="vaxNo" class="ml-2 text-gray-700">No</label></div>
                </div>
            </div>
            <div class="form-group col-span-2">
                <label for="vaccineType" class="block font-medium text-gray-600 mb-1">If yes, what vaccine?</label>
                <input type="text" id="vaccineType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150">
            </div>
            
            <div class="form-group col-span-2 hidden" id="willingToVaxContainer">
                <label class="block font-medium text-gray-600 mb-2">If not vaccinated, are you willing to get vaccinated?</label>
                <div class="radio-group flex flex-wrap gap-x-8 gap-y-4">
                    <div class="flex items-center"><input type="radio" name="willingToVax" value="Yes" id="willVaxYes" class="h-4 w-4 text-blue-600"><label for="willVaxYes" class="ml-2 text-gray-700">Yes</label></div>
                    <div class="flex items-center"><input type="radio" name="willingToVax" value="No" id="willVaxNo" class="h-4 w-4 text-blue-600"><label for="willVaxNo" class="ml-2 text-gray-700">No</label></div>
                </div>
            </div>
        </div>

        <div class="my-6 border-t border-gray-200"></div>
        
        <div class="grid sm:grid-cols-2 gap-6">
            <div class="form-group">
                <label class="block font-medium text-gray-600 mb-2">Do you have any pre-existing medical conditions?</label>
                <div class="radio-group flex flex-wrap gap-x-8 gap-y-4">
                    <div class="flex items-center"><input type="radio" name="medical" value="Yes" id="medYes" class="h-4 w-4 text-blue-600" onchange="toggleReason('medical', true)"><label for="medYes" class="ml-2 text-gray-700">Yes</label></div>
                    <div class="flex items-center"><input type="radio" name="medical" value="No" id="medNo" class="h-4 w-4 text-blue-600" onchange="toggleReason('medical', false)"><label for="medNo" class="ml-2 text-gray-700">No</label></div>
                </div>
                <div id="medicalReasonContainer" class="mt-3 hidden transition duration-300">
                    <label for="medicalReason" class="block text-sm text-gray-600 mb-1">If yes, what?</label>
                    <input type="text" id="medicalReason" class="w-full p-2 rounded-lg reason-input-field" value="">
                </div>
            </div>

            <div class="form-group">
                <label class="block font-medium text-gray-600 mb-2">Are you currently under a doctor’s care?</label>
                <div class="radio-group flex flex-wrap gap-x-8 gap-y-4">
                    <div class="flex items-center"><input type="radio" name="doctorCare" value="Yes" id="docYes" class="h-4 w-4 text-blue-600" onchange="toggleReason('doctorCare', true)"><label for="docYes" class="ml-2 text-gray-700">Yes</label></div>
                    <div class="flex items-center"><input type="radio" name="doctorCare" value="No" id="docNo" class="h-4 w-4 text-blue-600" onchange="toggleReason('doctorCare', false)"><label for="docNo" class="ml-2 text-gray-700">No</label></div>
                </div>
                <div id="doctorCareReasonContainer" class="mt-3 hidden transition duration-300">
                    <label for="doctorCareReason" class="block text-sm text-gray-600 mb-1">If yes, what?</label>
                    <input type="text" id="doctorCareReason" class="w-full p-2 rounded-lg reason-input-field" value="">
                </div>
            </div>

            <div class="form-group">
                <label class="block font-medium text-gray-600 mb-2">Have you ever been arrested or convicted of a crime?</label>
                <div class="radio-group flex flex-wrap gap-x-8 gap-y-4">
                    <div class="flex items-center"><input type="radio" name="crime" value="Yes" id="crimeYes" class="h-4 w-4 text-blue-600" onchange="toggleReason('crime', true)"><label for="crimeYes" class="ml-2 text-gray-700">Yes</label></div>
                    <div class="flex items-center"><input type="radio" name="crime" value="No" id="crimeNo" class="h-4 w-4 text-blue-600" onchange="toggleReason('crime', false)"><label for="crimeNo" class="ml-2 text-gray-700">No</label></div>
                </div>
                <div id="crimeReasonContainer" class="mt-3 hidden transition duration-300">
                    <label for="crimeReason" class="block text-sm text-gray-600 mb-1">If yes, what?</label>
                    <input type="text" id="crimeReason" class="w-full p-2 rounded-lg reason-input-field" value="">
                </div>
            </div>

            <div class="form-group">
                <label class="block font-medium text-gray-600 mb-2">Have you ever been denied a US Visa or denied entry?</label>
                <div class="radio-group flex flex-wrap gap-x-8 gap-y-4">
                    <div class="flex items-center"><input type="radio" name="visa" value="Yes" id="visaYes" class="h-4 w-4 text-blue-600" onchange="toggleReason('visa', true)"><label for="visaYes" class="ml-2 text-gray-700">Yes</label></div>
                    <div class="flex items-center"><input type="radio" name="visa" value="No" id="visaNo" class="h-4 w-4 text-blue-600" onchange="toggleReason('visa', false)"><label for="visaNo" class="ml-2 text-gray-700">No</label></div>
                </div>
                <div id="visaReasonContainer" class="mt-3 hidden transition duration-300">
                    <label for="visaReason" class="block text-sm text-gray-600 mb-1">If yes, what?</label>
                    <input type="text" id="visaReason" class="w-full p-2 rounded-lg reason-input-field" value="">
                </div>
            </div>
        </div>
    </div>

    <button type="submit" class="mt-10 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg text-xl shadow-lg transition duration-200 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50 w-full">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        Download Professional PDF Report
    </button>
</form>

<script>
    function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });

        // --- Configuration ---
        const pageHeight = doc.internal.pageSize.getHeight();
        const docWidth = doc.internal.pageSize.getWidth();
        const marginX = 20;
        const contentWidth = docWidth - (2 * marginX);
        
        let yPos = 20;
        const sectionSpacing = 10;
        let pageNumber = 1;

        // --- Helper Functions ---
        const getRadioValue = (name) => {
            const radios = document.getElementsByName(name);
            for (let i = 0; i < radios.length; i++) {
                if (radios[i].checked) return radios[i].value;
            }
            // Changed from 'N/A' to 'Unanswered' to reflect that fields are no longer mandatory
            return 'Unanswered'; 
        };
        
        const getReferralValue = () => {
            const referralSelect = document.getElementById('referralSource');
            if (!referralSelect.value) return 'Unanswered'; // Handle unselected case
            if (referralSelect.value === 'Other') {
                const otherValue = document.getElementById('otherReferralSource').value || 'Not specified';
                return `Other: ${otherValue}`;
            }
            return referralSelect.value;
        };

        const getReason = (name) => {
            const reasonInput = document.getElementById(`${name}Reason`);
            const reason = reasonInput ? reasonInput.value.trim() : '';
            // Change default message for non-required fields
            return reason || 'No details provided.'; 
        };

        // CORRECTED: Get the conditional vaccination question value
        const getWillingToVax = () => {
            if (getRadioValue('vaccinated') === 'No') {
                const willingVax = getRadioValue('willingToVax');
                // Use a proper message for unanswered conditional field
                return willingVax !== 'Unanswered' ? willingVax : 'Unanswered (Condition met)'; 
            }
            return 'N/A (Vaccinated: Yes)';
        };

        const checkPageBreak = (currentY, spaceNeeded) => {
            if (currentY + spaceNeeded > pageHeight - 20) { // 20mm from the bottom
                doc.addPage();
                yPos = 20;
                pageNumber++;
                
                doc.setFontSize(14).setFont(undefined, 'bold').setTextColor(25, 25, 112);
                doc.text("ManikShan Foreign Employment PVT LTD (Continued)", docWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(marginX, yPos, docWidth - marginX, yPos);
                yPos += sectionSpacing;
            }
        };

        const addDetail = (doc, question, answer, reason = null) => {
            checkPageBreak(yPos, 35); 

            const questionX = marginX;
            const answerX = marginX + contentWidth * 0.50;
            const answerWidth = contentWidth * 0.50 - 2;
            
            // Use 'Unanswered' for empty text inputs that are no longer required
            const finalAnswer = (typeof answer === 'string' && answer.trim() === '') ? 'Unanswered' : answer;

            doc.setFontSize(10).setFont(undefined, 'bold').setTextColor(40, 40, 40); 
            const splitQuestion = doc.splitTextToSize(question, contentWidth * 0.45);
            doc.text(splitQuestion, questionX, yPos + 2);

            let totalAnswerLines = doc.splitTextToSize(finalAnswer, answerWidth).length;
            
            let reasonLines = 0;
            if (reason) {
                reasonLines = doc.splitTextToSize(`Details: ${reason}`, answerWidth).length;
                totalAnswerLines += reasonLines + 1;
            }

            const boxHeight = (Math.max(1, totalAnswerLines) * 5) + 4;

            doc.setFillColor(240, 248, 255);
            doc.roundedRect(answerX, yPos - 1, answerWidth + 2, boxHeight, 2, 2, 'F');

            let currentAnswerY = yPos + 2;
            doc.setFontSize(11).setFont(undefined, 'normal').setTextColor(0, 0, 0);
            const splitAnswer = doc.splitTextToSize(finalAnswer, answerWidth);
            doc.text(splitAnswer, answerX + 1, currentAnswerY);
            currentAnswerY += splitAnswer.length * 5;

            if (reason) {
                currentAnswerY += 1;
                doc.setDrawColor(200, 200, 200).setLineWidth(0.1);
                doc.line(answerX + 1, currentAnswerY, answerX + answerWidth + 1, currentAnswerY);
                currentAnswerY += 2;
                
                doc.setFontSize(9).setFont(undefined, 'italic').setTextColor(80, 80, 80);
                const splitReason = doc.splitTextToSize(`Details: ${reason}`, answerWidth);
                doc.text(splitReason, answerX + 1, currentAnswerY);
                currentAnswerY += splitReason.length * 4;
            }

            const questionHeight = splitQuestion.length * 5;
            const contentHeight = Math.max(boxHeight, questionHeight);

            yPos += contentHeight + 4;

            doc.setDrawColor(220, 220, 220).setLineWidth(0.1);
            doc.line(marginX, yPos, docWidth - marginX, yPos);
            yPos += 3;
        };

        // --- Document Header ---
        doc.setFontSize(24).setFont(undefined, 'bold').setTextColor(25, 25, 112);
        doc.text("ManikShan Foreign Employment PVT LTD", docWidth / 2, yPos, { align: 'center' });
        yPos += 10;
        
        doc.setFontSize(10).setFont(undefined, 'normal').setTextColor(100, 100, 100);
        doc.text(`Report Generated: ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}`, docWidth - marginX, yPos, { align: 'right' });
        yPos += sectionSpacing;

        doc.setDrawColor(25, 25, 112).setLineWidth(0.5);
        doc.line(marginX, yPos, docWidth - marginX, yPos);
        yPos += sectionSpacing;
        
        // --- Pre-process answers for complex fields ---
        const programStartValue = document.getElementById('asap').checked ? 'As soon as possible' : document.getElementById('programStart').value;
        const departmentAnswer = `First Choice: ${document.getElementById('firstChoice').value || 'Unanswered'}\nSecond Choice: ${document.getElementById('secondChoice').value || 'Unanswered'}`;
        
        // CORRECTED: Program answer now displays the start date AND the selected length.
        const programAnswer = `${programStartValue || 'Unanswered'} (${getRadioValue('length')})`;

        // --- Data Structure with Reason Check ---
        const data = [
            { section: "1. Personal Details", items: [
                { q: 'Name:', a: document.getElementById('name').value },
                { q: 'Email:', a: document.getElementById('email').value },
                { q: 'Skype ID:', a: document.getElementById('skype').value }
            ]},
            { section: "2. Program & Referral Information", items: [
                { q: 'How did you hear about ManikShan Foreign Employment?', a: getReferralValue() },
                { q: 'Referred by:', a: document.getElementById('referredBy').value },
                // CORRECTED: Agency reason now links to the 'If yes, what Agency and what fees...' label
                { q: 'Working with any other Agency?', a: getRadioValue('agency'), reasonFor: 'Yes', rName: 'agency' } 
            ]},
            { section: "3. Placement Preferences", items: [
                { q: 'What department(s) are you applying for?', a: departmentAnswer },
                // CORRECTED: The question now uses the combined answer with the selected length
                { q: 'When do you want to begin your program and for how long?', a: programAnswer }, 
            ]},
            { section: "4. USA and Placement Status", items: [
                { q: 'Are you 100% open to ALL locations?', a: getRadioValue('location'), reasonFor: 'No', rName: 'location' },
                { q: 'Do you want a Custom Placement with another candidate?', a: getRadioValue('customPlacement'), reasonFor: 'Yes', rName: 'customPlacement' },
                { q: 'Have you ever trained/worked in the USA?', a: getRadioValue('workedUSA'), reasonFor: 'Yes', rName: 'workedUSA' },
                { q: 'Do you have any family that resides in the USA?', a: getRadioValue('familyUSA'), reasonFor: 'Yes', rName: 'familyUSA' }
            ]},
            { section: "5. Health & Legal & Visa Status", items: [
                { q: 'Are you vaccinated?', a: getRadioValue('vaccinated') },
                { q: 'If yes, what vaccine?', a: document.getElementById('vaccineType').value },
                // CORRECTED: NEW ITEM: Conditional vaccination status (only displays if 'vaccinated' is 'No')
                { q: 'If not vaccinated, are you willing to get vaccinated?', a: getWillingToVax(), conditionalFor: 'vaccinated', expectedValue: 'No' }, 
                { q: 'Do you have any pre-existing medical conditions?', a: getRadioValue('medical'), reasonFor: 'Yes', rName: 'medical' },
                { q: 'Are you currently under a doctor’s care?', a: getRadioValue('doctorCare'), reasonFor: 'Yes', rName: 'doctorCare' },
                { q: 'Have you ever been arrested or convicted of a crime?', a: getRadioValue('crime'), reasonFor: 'Yes', rName: 'crime' },
                { q: 'Have you ever been denied a US Visa or denied entry?', a: getRadioValue('visa'), reasonFor: 'Yes', rName: 'visa' }
            ]}
        ];

        // --- Document Generation Loop ---
        data.forEach(sectionData => {
            checkPageBreak(yPos, sectionSpacing * 2);
            
            doc.setFontSize(16).setFont(undefined, 'bold').setTextColor(0, 128, 0);
            doc.text(sectionData.section, marginX, yPos);
            yPos += 5;
            doc.setDrawColor(0, 128, 0).setLineWidth(0.4);
            doc.line(marginX, yPos, docWidth - marginX, yPos); 
            yPos += 7;

            sectionData.items.forEach(item => {
                // Skip the conditional vaccination question if the main 'vaccinated' answer is 'Yes'
                if (item.conditionalFor && getRadioValue(item.conditionalFor) !== item.expectedValue) {
                    return; 
                }
                // Only provide a reason if the radio button matches the required response (e.g., Yes for Medical) AND a reason was actually typed.
                const reason = (item.reasonFor && item.a === item.reasonFor) ? getReason(item.rName) : null;
                addDetail(doc, item.q, item.a, reason);
            });
            yPos += 5;
        });


        // --- Footer (Page Numbers) ---
        const totalPages = doc.internal.getNumberOfPages();
        for (let i = 1; i <= totalPages; i++) {
            doc.setPage(i);
            doc.setFontSize(8).setFont(undefined, 'italic').setTextColor(150, 150, 150);
            doc.text(`Page ${i} of ${totalPages}`, docWidth / 2, pageHeight - 10, { align: 'center' });
        }


        // --- Save PDF ---
        doc.save(`ManikShan_Questionnaire_Report.pdf`);
    }
</script>

</body>
</html>
